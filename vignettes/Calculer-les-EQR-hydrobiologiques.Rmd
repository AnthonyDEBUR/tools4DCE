---
title: "Calculer-les-EQR-hydrobiologiques"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Calculer-les-EQR-hydrobiologiques}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r message=FALSE, warning = FALSE}
library(tools4DCE)
```
Ce document explique comment télécharger des indices hydrobiologiques depuis Hubeau, convertir IBD et IBMR en EQR, affecter une classe de qualité aux résultats selon la typologie des stations de mesures.

# Chargement de donnees hydrobiologiques depuis Hubeau

A partir de la plateforme Hubeau, on télécharge les données hydrobiologiques disponibles sur la station 04207400.

```{r}
donnees<-import_hubeau_indices_hbio(liste_stations = c("04207400"))
str(donnees)
```


# Conversion des notes IBD et IBMR en EQR

Le package tools4DCE fournit une table avec les paramètres nécessaires au calcul des EQR selon la typologie de cours d'eau, conformément à l'arrêté ministériel du 25 janvier 2010 modifié.

```{r}
str(base_ref_eqr)


```
## Calcul des EQR

Le package contient une fonction pour calculer les EQR.

```{r}
donnees_IBD<-donnees%>%subset(CdParametre=="5856" & !is.na(RsAna))
donnees_IBD$EQR<-sapply(donnees_IBD$RsAna, function(x){calcule_EQR_hbio(x, CdParametre='5856', typologie="P12-A")})

```

## Graphique des résultats
Le package permet de mettre facilement les résultats sous forme graphique

Création d'un seuil qualité :
```{r, fig.width=6}
seuil_IBD<-makeSeuils(CdParametre = "5856", type_seuil = "DCE", specificites = "<10000 km2")
graphDCE_points(donnees_IBD, col_valeurs = "EQR", seuils=seuil_IBD, ymini=0, ymaxi=1) + ylab("EQR")


```

## Calcul de la classe de qualité correspondant à chaque résultat
Il permet également d'affecter une classe de qualité à chaque résultat.

Création d'un seuil qualité :
```{r}
donnees_IBD$CLASSE<-sapply(donnees_IBD$EQR, function(x){affecte_une_classe(x, seuil_IBD)})

```



